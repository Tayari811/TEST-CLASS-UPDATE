@isTest
public class LQ_MultiSelectLookupControllerTest {

    static testMethod void testIsValidBNSFId() {
        // Case 1: Test with a valid BNSF ID
        String validBNSFID = 'AUTOTEST';
        List<my_apps__x> output = LQ_MultiSelectLookupController.isValidBNSFId(validBNSFID);
        System.assertNotEquals(0, output.size(), 'Expected valid BNSF ID to return some results.');

        // Case 2: Test with an invalid BNSF ID
        String invalidBNSFID = 'Dummy';
        try {
            output = LQ_MultiSelectLookupController.isValidBNSFId(invalidBNSFID);
            System.assert(false, 'Expected an AuraHandledException for an invalid BNSF ID');
        } catch (AuraHandledException e) {
            System.assert(e.getMessage().contains('Please Enter valid BNSF Id'), 'Expected exception for invalid BNSF ID');
        }

        // Case 3: Test with a null BNSF ID
        output = LQ_MultiSelectLookupController.isValidBNSFId(null);
        System.assertEquals(0, output.size(), 'Expected no results for null BNSF ID');
    }

    static testMethod void testGetAdditionalApplication() {
        // Test that the method returns a list, even if itâ€™s empty
        List<BNSF_Application__c> additionalAppList = LQ_MultiSelectLookupController.getAdditionalApplication();
        System.assertNotEquals(null, additionalAppList, 'Expected additional application list to be non-null.');
    }

    static testMethod void testCheckApplicationAccessRequest() {
        // Setting up test data
        Contact contact = new Contact(
            FirstName = 'Test',
            LastName = 'User',
            MyBNSF_ID__c = 'AUTOTEST'
        );
        insert contact;

        // Insert Application_Access_Request__c records with various field values to test different conditions
        insert new Application_Access_Request__c(Customer__c = contact.Id, Manage_Various_Freight_Invoices__c = true, CreatedDate = Date.today().addDays(-10));
        insert new Application_Access_Request__c(Customer__c = contact.Id, Pay_Storage_Fees__c = true, CreatedDate = Date.today().addDays(-10));
        insert new Application_Access_Request__c(Customer__c = contact.Id, Order_Railcars__c = true, CreatedDate = Date.today().addDays(-10));
        insert new Application_Access_Request__c(Customer__c = contact.Id, Create_Or_Submit_Billing__c = true, CreatedDate = Date.today().addDays(-10));
        insert new Application_Access_Request__c(Customer__c = contact.Id, Switch_Or_In_Release_Rail_Cars__c = true, CreatedDate = Date.today().addDays(-10));
        insert new Application_Access_Request__c(Customer__c = contact.Id, Manage_Demurrage_Invoices__c = true, CreatedDate = Date.today().addDays(-10));
        
        // Run method and validate results for each condition
        System.assertEquals(true, LQ_MultiSelectLookupController.checkApplicationAccessRequest('Account Status'), 'Expected to find Manage_Various_Freight_Invoices');
        System.assertEquals(true, LQ_MultiSelectLookupController.checkApplicationAccessRequest('Intermodal Storage'), 'Expected to find Pay_Storage_Fees');
        System.assertEquals(true, LQ_MultiSelectLookupController.checkApplicationAccessRequest('Railcar Equipment Request'), 'Expected to find Order_Railcars');
        System.assertEquals(true, LQ_MultiSelectLookupController.checkApplicationAccessRequest('Shipping Instructions'), 'Expected to find Create_Or_Submit_Billing');
        System.assertEquals(true, LQ_MultiSelectLookupController.checkApplicationAccessRequest('Switch Or In Release Rail Cars'), 'Expected to find Switch_Or_In_Release_Rail_Cars');
        System.assertEquals(true, LQ_MultiSelectLookupController.checkApplicationAccessRequest('Customer Dwell Management Tool'), 'Expected to find Manage_Demurrage_Invoices');
    }

    static testMethod void testCreateApplicationAccessRequest() {
        // Set up Account, Contact, and User
        Account account = new Account(Name = 'Test Account');
        insert account;

        Contact contact = new Contact(
            FirstName = 'Test',
            LastName = 'User',
            AccountId = account.Id,
            MyBNSF_ID__c = 'AUTOTEST',
            Email = 'test@example.com'
        );
        insert contact;

        // Run test in a specific user context
        User adminUser = [SELECT Id FROM User WHERE Profile.Name = 'System Administrator' LIMIT 1];
        System.runAs(adminUser) {
            // Case 1: Create access request with all valid inputs
            Boolean result = LQ_MultiSelectLookupController.createApplicationAccessRequest(
                'AUTOTEST', '0165550001,0373322323', '', false, false, 'B R SIDING,WI', 
                'C JUAREZ,CI', true, true, true, true, true, true, 
                '401k,AEI Utility-WAS6', 'Test comments'
            );
            System.assertEquals(true, result, 'Expected application access request creation to succeed.');

            // Validate that the access request record is created
            List<Application_Access_Request__c> appAccReqList = [SELECT Id FROM Application_Access_Request__c];
            System.assertEquals(1, appAccReqList.size(), 'Expected one access request to be created.');

            // Case 2: Attempt to create a duplicate access request, which should return false
            result = LQ_MultiSelectLookupController.createApplicationAccessRequest(
                'AUTOTEST', '0165550001,0373322323', '', false, false, 'B R SIDING,WI', 
                'C JUAREZ,CI', true, true, true, true, true, true, 
                '401k,AEI Utility-WAS6', 'Test comments'
            );
            System.assertEquals(false, result, 'Expected duplicate request to be prevented.');

            // Case 3: Test missing optional fields
            result = LQ_MultiSelectLookupController.createApplicationAccessRequest(
                'AUTOTEST', '', '', false, false, '', '', false, false, false, false, false, false, '', ''
            );
            System.assertEquals(true, result, 'Expected success even with minimal fields filled.');
        }
    }
}
